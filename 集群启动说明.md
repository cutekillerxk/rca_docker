# Hadoop é›†ç¾¤ä¸€é”®å¯åŠ¨è¯´æ˜

## ğŸ“‹ å‰ç½®æ¡ä»¶

ç¡®ä¿ä»¥ä¸‹é•œåƒå·²å­˜åœ¨ï¼š
- `myhadoop-namenode:v1`
- `myhadoop-datanode1:v1`
- `myhadoop-datanode2:v1`

æ£€æŸ¥é•œåƒï¼š
```bash
docker images | grep myhadoop
```

## ğŸš€ ä¸€é”®å¯åŠ¨é›†ç¾¤

### å¯åŠ¨å‘½ä»¤
```bash
docker-compose up -d
```

### æŸ¥çœ‹çŠ¶æ€
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f namenode
```

### åœæ­¢é›†ç¾¤
```bash
docker-compose down
```

### åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆä¼šåˆ é™¤ HDFS æ•°æ®ï¼‰
```bash
docker-compose down -v
```

## ğŸ”Œ ç«¯å£æ˜ å°„

### NameNode
- **9870**: NameNode Web UI - http://localhost:9870
- **9000**: HDFS RPC
- **8020**: HDFS RPC (alternative)
- **50070**: NameNode Web UI (Hadoop 2.x)
- **2222**: SSH

### DataNode1
- **9864**: DataNode Web UI - http://localhost:9864
- **2223**: SSH

### DataNode2
- **9865**: DataNode Web UI - http://localhost:9865
- **2224**: SSH

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. é¦–æ¬¡å¯åŠ¨åæ ¼å¼åŒ– NameNodeï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
docker exec -it hadoop-namenode /bin/bash
su - hadoop

```

### 2. å¯åŠ¨ HDFS æœåŠ¡
```bash
# è¿›å…¥ namenode å®¹å™¨
docker exec -it hadoop-namenode /bin/bash
su - hadoop

# å¯åŠ¨ HDFS
start-dfs.sh

# æ£€æŸ¥çŠ¶æ€
jps
hdfs dfsadmin -report
```

### 3. æµ‹è¯• HDFS
```bash
# åœ¨ namenode å®¹å™¨ä¸­ï¼ˆhadoop ç”¨æˆ·ï¼‰
hdfs dfs -mkdir /test
hdfs dfs -ls /
hdfs dfs -put <æœ¬åœ°æ–‡ä»¶> /test/
hdfs dfs -ls /test
```

### 4. è®¿é—® Web UI
- NameNode: http://localhost:9870
- DataNode1: http://localhost:9864
- DataNode2: http://localhost:9865

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### è¿›å…¥å®¹å™¨
```bash
# NameNode
docker exec -it hadoop-namenode /bin/bash

# DataNode1
docker exec -it hadoop-datanode1 /bin/bash

# DataNode2
docker exec -it hadoop-datanode2 /bin/bash
```

### åˆ‡æ¢åˆ° hadoop ç”¨æˆ·
```bash
su - hadoop
```

### æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
```bash
# åœ¨ namenode å®¹å™¨ä¸­ï¼ˆhadoop ç”¨æˆ·ï¼‰
hdfs dfsadmin -report
jps
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# NameNode æ—¥å¿—
docker exec hadoop-namenode tail -f /usr/local/hadoop/logs/hadoop-hadoop-namenode-namenode.log

# DataNode æ—¥å¿—
docker exec hadoop-datanode1 tail -f /usr/local/hadoop/logs/hadoop-hadoop-datanode-datanode1.log
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…åŒ–**ï¼šHDFS æ•°æ®ä¿å­˜åœ¨ Docker volumes ä¸­ï¼Œåˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±æ•°æ®
2. **SSH è®¿é—®**ï¼šä½¿ç”¨æ˜ å°„çš„ç«¯å£è®¿é—® SSHï¼ˆ2222, 2223, 2224ï¼‰
3. **ç½‘ç»œ**ï¼šæ‰€æœ‰å®¹å™¨åœ¨ `hadoop-network` ç½‘ç»œä¸­ï¼Œå¯ä»¥é€šè¿‡ hostname äº’ç›¸è®¿é—®
4. **é‡å¯ç­–ç•¥**ï¼šå®¹å™¨è®¾ç½®ä¸º `unless-stopped`ï¼Œä¼šè‡ªåŠ¨é‡å¯

## ğŸ› æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs namenode
docker-compose logs datanode1
docker-compose logs datanode2
```

### ç«¯å£å†²çª
å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„

### ç½‘ç»œé—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œ
docker network inspect hadoop-network

# é‡æ–°åˆ›å»ºç½‘ç»œ
docker-compose down
docker network rm hadoop-network
docker-compose up -d
```

### DataNode æ— æ³•è¿æ¥åˆ° NameNodeï¼ˆclusterID ä¸åŒ¹é…ï¼‰

**é—®é¢˜ç°è±¡ï¼š**
- `hdfs dfsadmin -report` æ˜¾ç¤º `Configured Capacity: 0 (0 B)`
- DataNode å®¹å™¨ä¸­ `jps` çœ‹ä¸åˆ° DataNode è¿›ç¨‹
- DataNode æ—¥å¿—ä¸­å‡ºç°é”™è¯¯ï¼š`Incompatible clusterIDs`

**åŸå› ï¼š**
NameNode è¢«é‡æ–°æ ¼å¼åŒ–åç”Ÿæˆäº†æ–°çš„ clusterIDï¼Œä½† DataNode ä»ä¿ç•™æ—§çš„ clusterIDï¼Œå¯¼è‡´æ— æ³•è¿æ¥ã€‚

**è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰ï¼šæ¸…ç† DataNode æ•°æ®ç›®å½•**

```bash
# 1. åœæ­¢ HDFS æœåŠ¡ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
docker exec namenode su - hadoop -c "stop-dfs.sh"

# 2. æ¸…ç† DataNode æ•°æ®ç›®å½•
docker exec datanode1 su - hadoop -c "rm -rf /usr/local/hadoop/hdfs/datanode/current/*"
docker exec datanode2 su - hadoop -c "rm -rf /usr/local/hadoop/hdfs/datanode/current/*"
docker exec namenode  su - hadoop -c "rm -rf /usr/local/hadoop/hdfs/datanode/current/*"

# 3. é‡æ–°å¯åŠ¨ HDFS
docker exec namenode su - hadoop -c "start-dfs.sh"

# 4. éªŒè¯è¿æ¥
docker exec namenode su - hadoop -c "hdfs dfsadmin -report"
```

**æ›¿ä»£æ–¹æ¡ˆï¼šå®Œå…¨é‡ç½®ï¼ˆä¼šä¸¢å¤±æ‰€æœ‰æ•°æ®ï¼‰**

å¦‚æœä¸Šè¿°æ–¹æ³•ä¸è¡Œï¼Œå¯ä»¥åˆ é™¤æ‰€æœ‰æ•°æ®å·é‡æ–°å¼€å§‹ï¼š

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨å’Œæ•°æ®å·
docker compose down -v

# é‡æ–°å¯åŠ¨
docker compose up -d

# æ ¼å¼åŒ– NameNodeï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰
docker exec -it namenode /bin/bash
su - hadoop
hdfs namenode -format

# å¯åŠ¨ HDFS
start-dfs.sh
```

**éªŒè¯ DataNode æ˜¯å¦æ­£å¸¸ï¼š**
```bash
# æ£€æŸ¥ DataNode è¿›ç¨‹
docker exec datanode1 su - hadoop -c "jps"  # åº”è¯¥çœ‹åˆ° DataNode
docker exec datanode2 su - hadoop -c "jps"  # åº”è¯¥çœ‹åˆ° DataNode

# æ£€æŸ¥é›†ç¾¤æŠ¥å‘Š
docker exec namenode su - hadoop -c "hdfs dfsadmin -report"
# åº”è¯¥æ˜¾ç¤º Live datanodes (2) å’Œå®¹é‡ä¿¡æ¯ï¼ˆä¸æ˜¯ 0 Bï¼‰
```

